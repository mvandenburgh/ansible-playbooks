---
- name: install nginx
  apt:
      name: nginx
      update_cache: yes
      state: latest
  become: yes
  
- name: erase current nginx config
  command: rm /etc/nginx/nginx.conf
  become: yes

- name: make new nginx config file
  file:
    path: "/etc/nginx/nginx.conf"
    state: present
  become: yes

- name: set up nginx conf for reverse proxy
  blockinfile:
    path: /etc/nginx/nginx.conf
    block: |
      http {
         upstream myapp1 {
          server 209.50.48.33;
          server 209.50.57.15;
      }

      server {
        listen 80;

        location / {
            proxy_pass http://myapp1;
        }
      }
    }
  become: yes
  
- name: restart nginx
  service:
      name: nginx
      state: restarted
  become: yes
