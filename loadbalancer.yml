---
- name: install nginx
  apt:
      name: nginx
      update_cache: yes
      state: latest
  become: yes
  
- name: erase current nginx config
  file: 
    path: "/etc/nginx/nginx.conf"
    state: absent
  become: yes

- name: make new nginx config file
  file:
    path: "/etc/nginx/nginx.conf"
    state: touch
  become: yes

- name: set up nginx conf for load balancing
  blockinfile:
    path: /etc/nginx/nginx.conf
    block: |
      events { }
      http {
          upstream myapp1 {
                server 209.50.48.33;
                server 209.50.57.15;
          }

          server {
              listen 80;

              location / {
                  proxy_pass http://myapp1;
              }
          }
      }
  become: yes
  
- name: restart nginx
  service:
      name: nginx
      state: restarted
  become: yes
